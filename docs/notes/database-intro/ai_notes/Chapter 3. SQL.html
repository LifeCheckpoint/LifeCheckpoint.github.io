<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-notes/database-intro/ai_notes/Chapter 3. SQL" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">03. SQL | Life_Checkpoint&#x27;s Blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://lifecheckpoint.github.io/docs/notes/database-intro/ai_notes/Chapter 3. SQL"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="03. SQL | Life_Checkpoint&#x27;s Blog"><meta data-rh="true" name="description" content="1. 其他数据模型 (Other Data Models)"><meta data-rh="true" property="og:description" content="1. 其他数据模型 (Other Data Models)"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lifecheckpoint.github.io/docs/notes/database-intro/ai_notes/Chapter 3. SQL"><link data-rh="true" rel="alternate" href="https://lifecheckpoint.github.io/docs/notes/database-intro/ai_notes/Chapter 3. SQL" hreflang="en"><link data-rh="true" rel="alternate" href="https://lifecheckpoint.github.io/docs/notes/database-intro/ai_notes/Chapter 3. SQL" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"03. SQL","item":"https://lifecheckpoint.github.io/docs/notes/database-intro/ai_notes/Chapter 3. SQL"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Life_Checkpoint&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Life_Checkpoint&#39;s Blog Atom Feed">






<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" crossorigin="anonymous">
<script src="/js/prism-mathematica.js" async></script><link rel="stylesheet" href="/assets/css/styles.54ca3038.css">
<script src="/assets/js/runtime~main.6f4fd7c2.js" defer="defer"></script>
<script src="/assets/js/main.7e57d3c0.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Lchpt.blog</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">文档 / 文字的力量</a><a class="navbar__item navbar__link" href="/blog">Blog / 碎碎念</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/LifeCheckpoint" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">欢迎</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/acgn/fan">永远不止的彼岸微风</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/computer_science/projects/manimgeo">不可以做机械降神派</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/math/integrate/div-sq-sin">也许会喜欢数学</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/notes/earth-science/words">什么笔记都往里丢…</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/notes/earth-science/words">地球科学概论</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/notes/database-intro/ai_notes/Chapter 1. 绪论：核心概念">数据库原理（东南 大学版）</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/notes/database-intro/ai_notes/Chapter 1. 绪论：核心概念">AI笔记</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/database-intro/ai_notes/Chapter 1. 绪论：核心概念">01. 绪论：核心概念</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/database-intro/ai_notes/Chapter 2. 数据模型">02. 数据模型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/notes/database-intro/ai_notes/Chapter 3. SQL">03. SQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/database-intro/ai_notes/Chapter 4. 系统原理">04. 系统原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/database-intro/ai_notes/Chapter 5. 数据库安全与完整性约束">05. 数据库安全与完整性约束</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/database-intro/ai_notes/Chapter 6. 数据库设计原理与实践">06. 数据库设计原理与实践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/database-intro/ai_notes/Chapter 7. 分布式数据库系统原理">07. 分布式数据库系统原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/database-intro/ai_notes/Chapter 8. 新兴研究与应用领域">08. 新兴研究与应用领域</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/database-intro/ai_notes/Chapter 9. 综合复习">09. 综合复习</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/notes/digital-logic/ai_notes/Lecture 1A. 数字系统与二进制编码：基础与运算">数字逻辑</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/notes/discrete-math/ai_notes/Lecture 2. 逻辑与证明">离散数学</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/notes/probability-and-statistic-of-engineering/ai_notes/Lecture 1. 概率论基础：从随机现象到条件独立">工程概率统计</a></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">什么笔记都往里丢…</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">数据库原理（东南大学版）</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">AI笔记</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">03. SQL</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>03. SQL</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-其他数据模型-other-data-models">1. 其他数据模型 (Other Data Models)<a href="#1-其他数据模型-other-data-models" class="hash-link" aria-label="Direct link to 1. 其他数据模型 (Other Data Models)" title="Direct link to 1. 其他数据模型 (Other Data Models)">​</a></h2>
<p>除了关系数据模型（Relational Data Model）之外，还存在多种数据模型，它们各自适用于不同的应用场景和数据特性。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-逻辑数据模型-logic-based-data-model">1.1 逻辑数据模型 (Logic-based Data Model)<a href="#11-逻辑数据模型-logic-based-data-model" class="hash-link" aria-label="Direct link to 1.1 逻辑数据模型 (Logic-based Data Model)" title="Direct link to 1.1 逻辑数据模型 (Logic-based Data Model)">​</a></h3>
<ul>
<li><strong>概念</strong>: 基于 逻辑推理的数据模型，通常与演绎数据库管理系统（Deductive DBMS）相关联。</li>
<li><strong>特点</strong>:<!-- -->
<ul>
<li>扩展了DBMS的查询功能，特别是<strong>递归查询</strong>（Recursive Query）功能。</li>
<li>增强了DBMS的<strong>演绎能力</strong>（Deductive Ability），能够从已知事实和规则中推导出新的事实。</li>
</ul>
</li>
<li><strong>应用</strong>: 适用于需要复杂推理和规则处理的领域，如专家系统、知识库等。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-时态数据模型-temporal-data-model">1.2 时态数据模型 (Temporal Data Model)<a href="#12-时态数据模型-temporal-data-model" class="hash-link" aria-label="Direct link to 1.2 时态数据模型 (Temporal Data Model)" title="Direct link to 1.2 时态数据模型 (Temporal Data Model)">​</a></h3>
<ul>
<li><strong>概念</strong>: 专门用于处理带有时间维度的数据，能够记录数据的历史状态和变化。</li>
<li><strong>特点</strong>: 支持时间点、时间段、有效时间、事务时间等概念，方便查询和分析数据在不同时间点的状态。</li>
<li><strong>应用</strong>: 审计、版本控制、历史数据分析等。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-空间数据模型-spatial-data-model">1.3 空间数据模型 (Spatial Data Model)<a href="#13-空间数据模型-spatial-data-model" class="hash-link" aria-label="Direct link to 1.3 空间数据模型 (Spatial Data Model)" title="Direct link to 1.3 空间数据模型 (Spatial Data Model)">​</a></h3>
<ul>
<li><strong>概念</strong>: 用于表示和操作具有空间位置信息的数据。</li>
<li><strong>特点</strong>: 支持点、线、面等几何对象，以及空间关系（如邻近、包含、相交）和空间操作（如缓冲区分析、路径规划）。</li>
<li><strong>应用</strong>: 地理信息系统（GIS）、导航系统、城市规划等。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="14-xml数据模型-xml-data-model">1.4 XML数据模型 (XML Data Model)<a href="#14-xml数据模型-xml-data-model" class="hash-link" aria-label="Direct link to 1.4 XML数据模型 (XML Data Model)" title="Direct link to 1.4 XML数据模型 (XML Data Model)">​</a></h3>
<ul>
<li><strong>概念</strong>: 基于可扩展标记语言（eXtensible Markup Language, XML）的数据模型，用于表示半结构化数据。</li>
<li><strong>特点</strong>:<!-- -->
<ul>
<li><strong>互联网数据存储</strong>（Store Data on Internet）：广泛用于Web服务和数据交换。</li>
<li><strong>常见数据交换标准</strong>（Common Data Exchange Standard）：作为不同系统之间数据传输的通用格式。</li>
<li><strong>信息系统集成</strong>（Information Systems Integration）：促进异构系统之间的数据互操作。</li>
<li><strong>半结构化数据表达</strong>（Expression of Semi-structured Data）：能够灵活表示结构不完全固定或不规则的数据。</li>
</ul>
</li>
<li><strong>应用</strong>: Web服务、数据集成、文档管理等。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-数据库管理系统用户接口-user-interfaces-of-dbms">2. 数据库管理系统用户接口 (User Interfaces of DBMS)<a href="#2-数据库管理系统用户接口-user-interfaces-of-dbms" class="hash-link" aria-label="Direct link to 2. 数据库管理系统用户接口 (User Interfaces of DBMS)" title="Direct link to 2. 数据库管理系统用户接口 (User Interfaces of DBMS)">​</a></h2>
<p>DBMS提供多种接口以支持用户访问数据库，包括：</p>
<ul>
<li><strong>查询语言</strong>（Query Languages）：用于数据查询和操作。<!-- -->
<ul>
<li><strong>形式化查询语言</strong>（Formal Query Language）：基于严格数学理论，如关系代数和关系演算。</li>
<li><strong>表格查询语言</strong>（Tabular Query Language, TQL）：通过填写表格进行查询。</li>
<li><strong>图形查询语言</strong>（Graphic Query Language, GQL）：通过图形界面进行查询。</li>
<li><strong>有限自然语言查询语言</strong>（Limited Natural Language Query Language）：允许使用受限的自然语言进行查询。</li>
</ul>
</li>
<li><strong>接口和维护工具</strong>（Interface and Maintaining Tools, GUI）：图形用户界面工具，方便数据库管理和维护。</li>
<li><strong>应用程序编程接口</strong>（Application Programming Interfaces, APIs）：供应用程序调用数据库功能的接口。</li>
<li><strong>类库</strong>（Class Library）：面向对象编程中封装数据库操作的类集合。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-关系查询语言-relational-query-languages">3. 关系查询语言 (Relational Query Languages)<a href="#3-关系查询语言-relational-query-languages" class="hash-link" aria-label="Direct link to 3. 关系查询语言 (Relational Query Languages)" title="Direct link to 3. 关系查询语言 (Relational Query Languages)">​</a></h2>
<p>关系查询语言允许从数据库中操作和检索数据。</p>
<ul>
<li><strong>特点</strong>:<!-- -->
<ul>
<li><strong>强大的形式化基础</strong>（Strong Formal Foundation）：基于逻辑，如关系代数和关系演算。</li>
<li><strong>支持优化</strong>（Allows for Much Optimization）：形式化基础使得查询优化成为可能。</li>
<li><strong>非图灵完备</strong>（Not Turing Complete）：查询语言不期望具备通用编程语言的所有功能，不用于复杂计算。</li>
<li><strong>高效访问大数据集</strong>（Support Easy, Efficient Access to Large Data Sets）：专注于高效地访问和处理大量数据。</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-形式化关系查询语言-formal-relational-query-languages">3.1 形式化关系查询语言 (Formal Relational Query Languages)<a href="#31-形式化关系查询语言-formal-relational-query-languages" class="hash-link" aria-label="Direct link to 3.1 形式化关系查询语言 (Formal Relational Query Languages)" title="Direct link to 3.1 形式化关系查询语言 (Formal Relational Query Languages)">​</a></h3>
<p>两种数学查询语言构成了“实际”语言（如SQL）的基础：</p>
<ul>
<li><strong>关系代数</strong>（Relational Algebra）：<!-- -->
<ul>
<li><strong>操作性更强</strong>（More Operational），描述如何计算结果。</li>
<li>非常适用于表示<strong>执行计划</strong>（Execution Plans）。</li>
</ul>
</li>
<li><strong>关系演算</strong>（Relational Calculus）：<!-- -->
<ul>
<li><strong>非操作性</strong>（Non-operational），<strong>声明性</strong>（Declarative），用户描述想要什么，而不是如何计算。</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-sql语言-sql-language">3.2 SQL语言 (SQL Language)<a href="#32-sql语言-sql-language" class="hash-link" aria-label="Direct link to 3.2 SQL语言 (SQL Language)" title="Direct link to 3.2 SQL语言 (SQL Language)">​</a></h3>
<p><strong>SQL</strong>（Structured Query Language，结构化查询语言）是目前最成功的关系数据库语言。</p>
<p>SQL语言根据功能可分为四部分：</p>
<ul>
<li><strong>数据定义语言</strong>（Data Definition Language, <strong>DDL</strong>）：用于定义、删除或修改数据模式（schema）。<!-- -->
<ul>
<li><strong>CREATE</strong>: 创建数据库对象（如表、视图、索引）。</li>
<li><strong>ALTER</strong>: 修改数据库对象的结构。</li>
<li><strong>DROP</strong>: 删除数据库对象。</li>
</ul>
</li>
<li><strong>查询语言</strong>（Query Language, <strong>QL</strong>）：用于检索数据。<!-- -->
<ul>
<li><strong>SELECT</strong>: 从数据库中检索数据。</li>
</ul>
</li>
<li><strong>数据操作语言</strong>（Data Manipulation Language, <strong>DML</strong>）：用于插入、删除或更新数据。<!-- -->
<ul>
<li><strong>INSERT</strong>: 向表中插入新  行。</li>
<li><strong>DELETE</strong>: 从表中删除行。</li>
<li><strong>UPDATE</strong>: 更新表中现有行的值。</li>
</ul>
</li>
<li><strong>数据控制语言</strong>（Data Control Language, <strong>DCL</strong>）：用于控制用户对数据的访问权限。<!-- -->
<ul>
<li><strong>GRANT</strong>: 授予用户权限。</li>
<li><strong>REVOKE</strong>: 撤销用户权限。</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-sql基本概念与查询-basic-sql-concepts-and-queries">4. SQL基本概念与查询 (Basic SQL Concepts and Queries)<a href="#4-sql基本概念与查询-basic-sql-concepts-and-queries" class="hash-link" aria-label="Direct link to 4. SQL基本概念与查询 (Basic SQL Concepts and Queries)" title="Direct link to 4. SQL基本概念与查询 (Basic SQL Concepts and Queries)">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-重要术语和概念-important-terms-and-concepts">4.1 重要术语和概念 (Important Terms and Concepts)<a href="#41-重要术语和概念-important-terms-and-concepts" class="hash-link" aria-label="Direct link to 4.1 重要术语和概念 (Important Terms and Concepts)" title="Direct link to 4.1 重要术语和概念 (Important Terms and Concepts)">​</a></h3>
<ul>
<li><strong>基本表</strong>（Base Table）：数据库中实际存储数据的表。</li>
<li><strong>视图</strong>（View）：基于一个或多个基本表或其他视图定义的<strong>虚拟表</strong>（Virtual Table），其数据不实际存储，而是通过查询动态生成。<!-- -->
<ul>
<li><strong>逻辑数据独立性</strong>（Logical Data Independence）：视图提供了一种抽象层，使得应用程序不必关心底层基本表的具体结构变化。</li>
<li><strong>数据安全性</strong>（Security of Data）：可以通过视图限制用户只能访问表中的部分数据或列。</li>
<li><strong>视图更新问题</strong>（Update Problems of View）：某些复杂的视图（如包含聚合函数、GROUP BY、JOIN等）可能无法直接更新。</li>
</ul>
</li>
<li><strong>支持的数据类型</strong>（Data Type Supported）：SQL支持多种数据类型，如整数、浮点数、字符串、日期时间等。</li>
<li><strong>NULL值</strong>（NULL）：表示未知（unknown）或不适用（inapplicable）的值。<!-- -->
<ul>
<li>NULL值会使许多操作复杂化，例如，<code>rating &gt; 8</code> 在 <code>rating</code> 为NULL时，结果既不是真也不是假，而是<strong>未知</strong>（unknown）。</li>
<li>需要<strong>三值逻辑</strong>（3-valued logic）：真（true）、假（false）、未知（unknown）。</li>
<li><code>WHERE</code> 子句会过滤掉计算结果为 <code>false</code> 或 <code>unknown</code> 的行。</li>
</ul>
</li>
<li><strong>UNIQUE约束</strong>：确保列中的所有值都是唯一的。</li>
<li><strong>DEFAULT约束</strong>：为列指定默认值。</li>
<li><strong>主键</strong>（PRIMARY KEY）：唯一标识表中每一行的列或列的组合。主键列的值必须是唯一的且不能为NULL。</li>
<li><strong>外键</strong>（FOREIGN KEY）：一个表中的列，其值引用另一个表中的主键。用于建立表之间的关系，维护<strong>参照完整性</strong>（Referential Integrity）。</li>
<li><strong>CHECK约束</strong>（Integration Constraint）：定义列中允许值的条件。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-基本查询语句-basic-query-statement">4.2 基本查询语句 (Basic Query Statement)<a href="#42-基本查询语句-basic-query-statement" class="hash-link" aria-label="Direct link to 4.2 基本查询语句 (Basic Query Statement)" title="Direct link to 4.2 基本查询语句 (Basic Query Statement)">​</a></h3>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTINCT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> target</span><span class="token operator">-</span><span class="token plain">list</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> relation</span><span class="token operator">-</span><span class="token plain">list</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> qualification</span><br></span></code></pre></div></div>
<ul>
<li><code>relation-list</code>：关系名称列表，每个名称后可带范围变量（range-variable）。</li>
<li><code>target-list</code>：<code>relation-list</code> 中关系的属性列表。</li>
<li><code>qualification</code>：使用 <code>AND</code>、<code>OR</code> 和 <code>NOT</code> 组合的比较条件。</li>
<li><code>DISTINCT</code>：可选关键字，表示结果中不包含重复行。默认情况下，不消除重复行。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="421-概念性评估策略-conceptual-evaluation-strategy">4.2.1 概念性评估策略 (Conceptual Evaluation Strategy)<a href="#421-概念性评估策略-conceptual-evaluation-strategy" class="hash-link" aria-label="Direct link to 4.2.1 概念性评估策略 (Conceptual Evaluation Strategy)" title="Direct link to 4.2.1 概念性评估策略 (Conceptual Evaluation Strategy)">​</a></h4>
<p>SQL查询的语义可以通过以下概念性评估策略来理解：</p>
<ol>
<li>计算 <code>relation-list</code> 中所有关系的<strong>笛卡尔积</strong>（Cross-product）。</li>
<li>如果结果元组不满足 <code>qualification</code> 条件，则<strong>丢弃</strong>（Discard）这些元组。</li>
<li><strong>删除</strong>（Delete）<code>target-list</code> 中未包含的属性。</li>
<li>如果指定了 <code>DISTINCT</code>，则<strong>消除重复行</strong>（Eliminate Duplicate Rows）。</li>
</ol>
<p><strong>注意</strong>：这种策略通常是计算查询效率最低的方式。查询优化器会寻找更高效的策略来计算相同的结果。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="422-范围变量-range-variables">4.2.2 范围变量 (Range Variables)<a href="#422-范围变量-range-variables" class="hash-link" aria-label="Direct link to 4.2.2 范围变量 (Range Variables)" title="Direct link to 4.2.2 范围变量 (Range Variables)">​</a></h4>
<p>当同一个关系在 <code>FROM</code> 子句中出现两次时，范围变量是必需的。即使不是必需，使用范围变量也是良好的编程风格。</p>
<p><strong>示例</strong>：
查找预订了船只 #103 的水手姓名：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sname</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Sailors S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Reserves R</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">=</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">AND</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">103</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p>或</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> sname</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Sailors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Reserves</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> Sailors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">=</span><span class="token plain"> Reserves</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">AND</span><span class="token plain"> bid </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">103</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="423-表达式和字符串-expressions-and-strings">4.2.3 表达式和字符串 (Expressions and Strings)<a href="#423-表达式和字符串-expressions-and-strings" class="hash-link" aria-label="Direct link to 4.2.3 表达式和字符串 (Expressions and Strings)" title="Direct link to 4.2.3 表达式和字符串 (Expressions and Strings)">​</a></h4>
<ul>
<li><strong>算术表达式</strong>（Arithmetic Expressions）：可以在 <code>SELECT</code> 子句中使用算术表达式。</li>
<li><strong>字符串模式匹配</strong>（String Pattern Matching）：使用 <code>LIKE</code> 操作符进行字符串匹配。<!-- -->
<ul>
<li><code>_</code>：代表任意一个字符。</li>
<li><code>%</code>：代表零个或多个任意字符。</li>
</ul>
</li>
<li><strong>结果字段命名</strong>：可以使用 <code>AS</code> 或 <code>=</code> 为结果中的字段命名。</li>
</ul>
<p><strong>示例</strong>：
查找水手年龄，以及年龄减5和年龄两倍的字段，条件是水手姓名以&#x27;B&#x27;开头和结尾，且至少包含三个字符。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">age</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> age1 </span><span class="token operator">=</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">age </span><span class="token operator">-</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">age </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> age2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Sailors S</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sname </span><span class="token operator">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;B_%B&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="424-集合操作符-set-operators">4.2.4 集合操作符 (Set Operators)<a href="#424-集合操作符-set-operators" class="hash-link" aria-label="Direct link to 4.2.4 集合操作符 (Set Operators)" title="Direct link to 4.2.4 集合操作符 (Set Operators)">​</a></h4>
<p>SQL支持集合操作，用于组合两个或多个查询的结果。</p>
<ul>
<li><strong>UNION</strong>：计算两个<strong>并兼容</strong>（union-compatible）结果集的并集。默认会消除重复行，<code>UNION ALL</code> 则保留所有重复行。</li>
<li><strong>INTERSECT</strong>：计算两个并兼容结果集的交集。SQL/92标准支持，但并非所有系统都实现。</li>
<li><strong>EXCEPT</strong>：计算第一个结果集减去第二个结果集的部分（差集）。</li>
</ul>
<p><strong>示例</strong>：
查找预订了红色或绿色船只的水手ID：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Sailors S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Boats B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Reserves R</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">=</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">AND</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token operator">=</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">color </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;red&#x27;</span><span class="token plain"> </span><span class="token operator">OR</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">color </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;green&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p>等价于：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Sailors S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Boats B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Reserves R</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">=</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">AND</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token operator">=</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token operator">AND</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">color </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;red&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UNION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Sailors S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Boats B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Reserves R</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">=</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">AND</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token operator">=</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token operator">AND</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">color </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;green&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p><strong>示例</strong>：
查找预订了红色<strong>和</strong>绿色船只的水手ID：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Sailors S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Boats B1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Reserves R1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Boats B2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Reserves R2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">=</span><span class="token plain"> R1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">AND</span><span class="token plain"> R1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token operator">=</span><span class="token plain"> B1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">AND</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">=</span><span class="token plain"> R2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">AND</span><span class="token plain"> R2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token operator">=</span><span class="token plain"> B2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">AND</span><span class="token plain"> B1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">color </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;red&#x27;</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> B2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">color </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;green&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p>等价于（如果系统支持 <code>INTERSECT</code>）：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Sailors S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Boats B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Reserves R</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">=</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">AND</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token operator">=</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token operator">AND</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">color </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;red&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INTERSECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Sailors S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Boats B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Reserves R</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">=</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">AND</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token operator">=</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token operator">AND</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">color </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;green&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="425-嵌套查询-nested-queries">4.2.5 嵌套查询 (Nested Queries)<a href="#425-嵌套查询-nested-queries" class="hash-link" aria-label="Direct link to 4.2.5 嵌套查询 (Nested Queries)" title="Direct link to 4.2.5 嵌套查询 (Nested Queries)">​</a></h4>
<p>SQL的一个强大特性是 <code>WHERE</code> 子句（以及 <code>FROM</code> 和 <code>HAVING</code> 子句）可以包含另一个SQL查询（<strong>子查询</strong>，Sub-query）。</p>
<ul>
<li><strong>IN/NOT IN</strong>：用于检查一个值是否在子查询结果集中。</li>
<li><strong>EXISTS/NOT EXISTS</strong>：用于检查子查询是否返回任何行。<!-- -->
<ul>
<li><strong>关联子查询</strong>（Correlated Subquery）：子查询的执行依赖于外部查询的每一行。</li>
</ul>
</li>
<li><strong>ANY/ALL</strong>：与比较操作符（&lt;, &gt;, =, &lt;=, &gt;=, !=）结合使用。<!-- -->
<ul>
<li><code>op ANY</code>：如果与子查询结果集中的<strong>任何一个</strong>值满足条件，则为真。</li>
<li><code>op ALL</code>：如果与子查询结果集中的<strong>所有</strong>值都满足条件，则为真。</li>
</ul>
</li>
<li><strong>UNIQUE</strong>：检查子查询结果集中是否存在重复行。</li>
</ul>
<p><strong>示例</strong>：
查找预订了船只 #103 的水手姓名：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sname</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Sailors S</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Reserves R </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">103</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p><strong>示例</strong>：
查找预订了船只 #103 的水手姓名（使用 <code>EXISTS</code>）：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sname</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Sailors S</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">EXISTS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Reserves R </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">103</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">=</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p><strong>示例</strong>：
查找评分高于某个名为“Horatio”的水手评分的水手：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Sailors S</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">rating </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ANY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> S2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">rating </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Sailors S2 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> S2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sname </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Horatio&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="426-除法运算-division-in-sql">4.2.6 除法运算 (Division in SQL)<a href="#426-除法运算-division-in-sql" class="hash-link" aria-label="Direct link to 4.2.6 除法运算 (Division in SQL)" title="Direct link to 4.2.6 除法运算 (Division in SQL)">​</a></h4>
<p>SQL中没有直接的除法操作符，但可以通过 <code>NOT EXISTS</code> 和 <code>EXCEPT</code>（或嵌套 <code>NOT EXISTS</code>）来实现关系代数中的除法操作。</p>
<p><strong>示例</strong>：
查找预订了 所有船只的水手姓名：
<strong>方案1 (使用EXCEPT)</strong>：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sname</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Sailors S</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">EXISTS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Boats B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">EXCEPT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Reserves R </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">=</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p><strong>方案2 (使用嵌套NOT EXISTS)</strong>：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sname</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Sailors S</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">EXISTS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Boats B</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">EXISTS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Reserves R</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token operator">=</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bid </span><span class="token operator">AND</span><span class="token plain"> R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid </span><span class="token operator">=</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p><strong>解释</strong>：
该查询的逻辑是：找出那些水手S，对于<strong>所有</strong>船只B，<strong>不存在</strong>一个船只B使得水手S<strong>没有</strong>预订它。换句话说，对于所有船只B，水手S都预订了它。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="427-聚合操作符-aggregate-operators">4.2.7 聚合操作符 (Aggregate Operators)<a href="#427-聚合操作符-aggregate-operators" class="hash-link" aria-label="Direct link to 4.2.7 聚合操作符 (Aggregate Operators)" title="Direct link to 4.2.7 聚合操作符 (Aggregate Operators)">​</a></h4>
<p>聚合操作符对一组值进行计算，并返回单个结果。</p>
<ul>
<li><code>COUNT(*)</code>：计算行数，包括NULL值。</li>
<li><code>COUNT([DISTINCT] A)</code>：计算列A中非NULL值的数量，<code>DISTINCT</code> 表示只计算唯一值。</li>
<li><code>SUM([DISTINCT] A)</code>：计算列A中非NULL值的总和，<code>DISTINCT</code> 表示只对唯一值求和。</li>
<li><code>AVG([DISTINCT] A)</code>：计算列A中非NULL值的平均值，<code>DISTINCT</code> 表示只对唯一值求平均。</li>
<li><code>MAX(A)</code>：计算列A中的最大值。</li>
<li><code>MIN(A)</code>：计算列A中的最小值。</li>
</ul>
<p><strong>注意</strong>：聚合操作符不能直接嵌套使用，例如 <code>MIN(AVG(S2.age))</code> 是错误的。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="428-group-by-和-having-子句">4.2.8 GROUP BY 和 HAVING 子句<a href="#428-group-by-和-having-子句" class="hash-link" aria-label="Direct link to 4.2.8 GROUP BY 和 HAVING 子句" title="Direct link to 4.2.8 GROUP BY 和 HAVING 子句">​</a></h4>
<ul>
<li><strong>GROUP BY</strong>：将查询结果按照一个或多个列的值进行分组。聚合函数将应用于每个组。<!-- -->
<ul>
<li><code>SELECT</code> 子句中非聚合的属性必须出现在 <code>GROUP BY</code> 子句中。</li>
</ul>
</li>
<li><strong>HAVING</strong>：用于过滤 <code>GROUP BY</code> 子句产生的组。它类似于 <code>WHERE</code> 子句，但作用于组而不是单个行。<!-- -->
<ul>
<li><code>HAVING</code> 子句中的条件可以包含聚合函数。</li>
</ul>
</li>
</ul>
<p><strong>语法</strong>：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DISTINCT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> target</span><span class="token operator">-</span><span class="token plain">list</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> relation</span><span class="token operator">-</span><span class="token plain">list</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> qualification</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> grouping</span><span class="token operator">-</span><span class="token plain">list</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HAVING</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token operator">-</span><span class="token plain">qualification</span><br></span></code></pre></div></div>
<p><strong>概念性评估</strong>：</p>
<ol>
<li>计算 <code>relation-list</code> 的笛卡尔积。</li>
<li>丢弃不满足 <code>qualification</code> 条件的元组。</li>
<li>根据 <code>grouping-list</code> 中的属性值将剩余元组<strong>分区</strong>（partition）成组。</li>
<li>对每个组应用 <code>group-qualification</code> 来<strong>消除</strong>（eliminate）一些组。<code>group-qualification</code> 中的表达式必须对每个组只有一个值。</li>
<li>为每个符合条件的组生成一个结果元组。</li>
</ol>
<p><strong>示例</strong>：
查找年龄大于等于18岁的水手中，每个评分等级下年龄最小的水手，且该评分等级至少有2个这样的水手。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">rating</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">MIN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">age</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> minage</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Sailors S</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">age </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">18</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">rating</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HAVING</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">COUNT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p><strong>示例</strong>：
查找平均年龄最小的评分等级：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Temp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">rating</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">rating</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">AVG</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">age</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> avgage</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Sailors S</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">rating</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Temp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Temp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">avgage </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">MIN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Temp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">avgage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Temp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p><strong>解释</strong>：这里使用了<strong>表表达式</strong>（Table Expression）来解决聚合函数不能嵌套的问题。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-sql新特性-new-features-of-sql">5. SQL新特性 (New Features of SQL)<a href="#5-sql新特性-new-features-of-sql" class="hash-link" aria-label="Direct link to 5. SQL新特性 (New Features of SQL)" title="Direct link to 5. SQL新特性 (New Features of SQL)">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-cast表达式-cast-expression">5.1 CAST表达式 (CAST Expression)<a href="#51-cast表达式-cast-expression" class="hash-link" aria-label="Direct link to 5.1 CAST表达式 (CAST Expression)" title="Direct link to 5.1 CAST表达式 (CAST Expression)">​</a></h3>
<ul>
<li><strong>概念</strong>：用于将表达式转换为目标数据类型。</li>
<li><strong>用途</strong>：<!-- -->
<ul>
<li>匹配函数参数的数据类型。</li>
<li>在计算中改变精度。</li>
<li>为 <code>NULL</code> 值指定数据类型。</li>
</ul>
</li>
<li><strong>语法</strong>：<code>CAST(Expression AS Data type)</code></li>
</ul>
<p><strong>示例</strong>：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> school</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> CAST</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Students</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UNION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> CAST</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Varchar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Soldiers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-case表达式-case-expression">5.2 CASE表达式 (CASE Expression)<a href="#52-case表达式-case-expression" class="hash-link" aria-label="Direct link to 5.2 CASE表达式 (CASE Expression)" title="Direct link to 5.2 CASE表达式 (CASE Expression)">​</a></h3>
<ul>
<li><strong>概念</strong>：根据条件返回不同的值，实现条件逻辑。</li>
<li><strong>简单形式</strong>：基于一个表达式的值进行匹配。</li>
<li><strong>通用形式</strong>：基于搜索条件进行匹配。</li>
</ul>
<p><strong>简单形式示例</strong>：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CASE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">status</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHEN</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">THEN</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Active Duty&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHEN</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">THEN</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Reserve&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHEN</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">THEN</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Special Assignment&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHEN</span><span class="token plain"> </span><span class="token number">4</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">THEN</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Retired&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ELSE</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Unknown&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">status</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Officers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p><strong>通用形式示例</strong>：
查找每种设备的平均事故率，避免除以零错误：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CASE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHEN</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">hours_used</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">THEN</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">accidents</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">hours_used</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ELSE</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> accident_rate</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> Machines</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="53-子查询增强-sub-query-enhancements">5.3 子查询增强 (Sub-query Enhancements)<a href="#53-子查询增强-sub-query-enhancements" class="hash-link" aria-label="Direct link to 5.3 子查询增强 (Sub-query Enhancements)" title="Direct link to 5.3 子查询增强 (Sub-query Enhancements)">​</a></h3>
<p>新SQL标准增强了子查询的功能，现在它们可以用于 <code>SELECT</code> 和 <code>FROM</code> 子句。</p>
<ul>
<li><strong>标量子查询</strong>（Scalar Sub-query）：<!-- -->
<ul>
<li><strong>概念</strong>：子查询的结果是一个<strong>单值</strong>（single value）。</li>
<li><strong>用途</strong>：可以在任何可以使用值的地方使用。</li>
<li><strong>示例</strong>：
列出纽约地区部门的部门号、部门名称和最高工资：<!-- -->
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> d</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">deptno</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> d</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">deptname</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">MAX</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">salary</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> emp </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> deptno </span><span class="token operator">=</span><span class="token plain"> d</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">deptno</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> maxpay</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> dept </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> d</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;New York&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
</li>
</ul>
</li>
<li><strong>表表达式</strong>（Table Expression）：<!-- -->
<ul>
<li><strong>概念</strong>：子查询的结果是一个<strong>表</strong>（table）。</li>
<li><strong>用途</strong>：可以在任何可以使用表的地方使用，相当于<strong>临时视图</strong>（temporary views）。</li>
<li><strong>示例</strong>：
查找总付款超过200000的部门：<!-- -->
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> deptno</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> totalpay</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> deptno</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">salary</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bonus</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> totalpay</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> emp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> deptno</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> payroll</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> totalpay </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token number">200000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
</li>
</ul>
</li>
<li><strong>公共表表达式</strong>（Common Table Expression, <strong>CTE</strong>）：<!-- -->
<ul>
<li><strong>概念</strong>：使用 <code>WITH</code> 子句定义的命名临时结果集，可以在单个SQL语句中多次引用。</li>
<li><strong>优点</strong>：提高可读性、避免重复计算、解决递归查询问题。</li>
<li><strong>用途</strong>：主要用于需要多级聚焦的复杂查询。</li>
<li><strong>语法</strong>：<code>WITH CTE_name (column1, column2, ...) AS (SELECT ...)</code></li>
<li><strong>示例</strong>：
查找总付款最高的部门：<!-- -->
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WITH</span><span class="token plain"> payroll</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">deptno</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> totalpay</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> deptno</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">salary</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bonus</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> emp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> deptno</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> deptno</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> payroll</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> totalpay </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">MAX</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">totalpay</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> payroll</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="54-外连接-outer-join">5.4 外连接 (Outer Join)<a href="#54-外连接-outer-join" class="hash-link" aria-label="Direct link to 5.4 外连接 (Outer Join)" title="Direct link to 5.4 外连接 (Outer Join)">​</a></h3>
<ul>
<li><strong>概念</strong>：在连接操作中，即使某个表中的行在另一个表中没有匹配的行，也会保留这些行，并在缺失匹配的列中填充 <code>NULL</code>。</li>
<li><strong>类型</strong>：<!-- -->
<ul>
<li><strong>左外连接</strong>（LEFT OUTER JOIN）：保留左表中的所有行。</li>
<li><strong>右外连接</strong>（RIGHT OUTER JOIN）：保留右表中的所有行。</li>
<li><strong>全外连接</strong>（FULL OUTER JOIN）：保留两个表中的所有行。</li>
</ul>
</li>
<li><strong>用途</strong>：当需要显示所有相关信息，包括那些没有匹配项的信息时。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="55-递归查询-recursion">5.5 递归查询 (Recursion)<a href="#55-递归查询-recursion" class="hash-link" aria-label="Direct link to 5.5 递归查询 (Recursion)" title="Direct link to 5.5 递归查询 (Recursion)">​</a></h3>
<ul>
<li><strong>概念</strong>：当公共表表达式在其定义中引用自身时，称为递归。</li>
<li><strong>用途</strong>：用于计算复杂的递归推断，如层次结构查询、图遍历等。</li>
<li><strong>语法</strong>：<code>WITH RECURSIVE CTE_name AS (initial_query UNION ALL recursive_query)</code>
<ul>
<li><code>initial_query</code>：定义递归的<strong>起始成员</strong>（anchor member）。</li>
<li><code>recursive_query</code>：定义递归的<strong>递归成员</strong>（recursive member），它引用CTE本身。</li>
</ul>
</li>
<li><strong>停止规则</strong>（Stopping Rule）：递归查询必须有明确的停止条件，以避免无限循环。</li>
</ul>
<p><strong>示例</strong>：
查找Hoover管理下且工资超过100000的所有员工：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WITH</span><span class="token plain"> RECURSIVE agents</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> salary</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> salary </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> FedEmp </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> manager </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Hoover&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">-- initial query</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UNION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ALL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">salary </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> agents </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> FedEmp </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> f </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">manager </span><span class="token operator">=</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">-- recursive query</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> name </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> agents </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> salary </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token number">100000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">-- final query</span><br></span></code></pre></div></div>
<p><strong>示例</strong>：
计算一个机翼中铆钉的总用量（经典“零件查找问题”）：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WITH</span><span class="token plain"> RECURSIVE wingpart</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">subpart</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> qty</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> subpart</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> qty </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> components </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> part </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;wing&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">-- initial query</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UNION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ALL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">subpart</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> w</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">qty </span><span class="token operator">*</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">qty </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> wingpart w</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> components c </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> w</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">subpart </span><span class="token operator">=</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">part</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">-- recursive query</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">qty</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> qty </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> wingpart </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> subpart </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;rivet&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p><strong>示例</strong>：
查找从SFO到JFK的最低总成本路线（递归搜索）：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WITH</span><span class="token plain"> RECURSIVE trips </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">destination</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> route</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> nsegs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> totalcost</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> destination</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> CAST</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">destination </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> cost </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> flights </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> origin </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;SFO&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">-- initial query</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UNION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ALL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">destination</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> CAST</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">route </span><span class="token operator">||</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;,&#x27;</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">destination </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">nsegs </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">totalcost </span><span class="token operator">+</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">cost</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> trips t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> flights f</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">destination </span><span class="token operator">=</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token operator">AND</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">destination </span><span class="token operator">&lt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;SFO&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">-- stopping rule 1: avoid direct loop back to origin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token operator">AND</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">origin </span><span class="token operator">&lt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;JFK&#x27;</span><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">-- stopping rule 2: avoid going back from destination</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token operator">AND</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">nsegs </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">          </span><span class="token comment" style="color:rgb(98, 114, 164)">-- stopping rule 3: limit path length</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> route</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> totalcost</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> trips</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> destination </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;JFK&#x27;</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> totalcost </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">MIN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">totalcost</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> trips </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> destination </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;JFK&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-嵌入式sql-embedded-sql">6. 嵌入式SQL (Embedded SQL)<a href="#6-嵌入式sql-embedded-sql" class="hash-link" aria-label="Direct link to 6. 嵌入式SQL (Embedded SQL)" title="Direct link to 6. 嵌入式SQL (Embedded SQL)">​</a></h2>
<p><strong>概念</strong>：将SQL语句嵌入到宿主编程语言（如C/C++）中，以便在程序中访问和处理数据库。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="61-解决的问题-problems-to-be-solved">6.1 解决的问题 (Problems to be Solved)<a href="#61-解决的问题-problems-to-be-solved" class="hash-link" aria-label="Direct link to 6.1 解决的问题 (Problems to be Solved)" title="Direct link to 6.1 解决的问题 (Problems to be Solved)">​</a></h3>
<ul>
<li>如何在编程语言中接受SQL语句。</li>
<li>如何在编程语言和DBMS之间交换数据和消息。</li>
<li>DBMS的查询结果是<strong>集合</strong>（set），如何将其转换为编程语言中的变量。</li>
<li>DBMS和编程语言的数据类型可能不完全相同。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="62-通用解决方案-general-solutions">6.2 通用解决方案 (General Solutions)<a href="#62-通用解决方案-general-solutions" class="hash-link" aria-label="Direct link to 6.2 通用解决方案 (General Solutions)" title="Direct link to 6.2 通用解决方案 (General Solutions)">​</a></h3>
<ul>
<li><strong>嵌入式SQL</strong>（Embedded SQL）：<!-- -->
<ul>
<li>最基本的方法。通过<strong>预编译</strong>（pre-compiling），将嵌入式SQL语句转换为对内部库函数的调用来访问数据库。</li>
</ul>
</li>
<li><strong>编程API</strong>（Programming APIs）：<!-- -->
<ul>
<li>提供一组库函数或DLLs，供程序员直接调用，并在编译时与应用程序链接。</li>
</ul>
</li>
<li><strong>类库</strong>（Class Library）：<!-- -->
<ul>
<li>面向对象编程出现后，将访问数据库的库函数封装成一组类，提供更便捷的数据库处理方式。</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="63-嵌入式sql的使用-usage-of-embedded-sql">6.3 嵌入式SQL的使用 (Usage of Embedded SQL)<a href="#63-嵌入式sql的使用-usage-of-embedded-sql" class="hash-link" aria-label="Direct link to 6.3 嵌入式SQL的使用 (Usage of Embedded SQL)" title="Direct link to 6.3 嵌入式SQL的使用 (Usage of Embedded SQL)">​</a></h3>
<ul>
<li><strong>SQL语句标记</strong>：以 <code>EXEC SQL</code> 开头，以 <code>;</code> 结尾。</li>
<li><strong>宿主  变量</strong>（Host Variables）：用于在C语言和SQL之间传递信息。<!-- -->
<ul>
<li>必须在 <code>EXEC SQL BEGIN DECLARE SECTION;</code> 和 <code>EXEC SQL END DECLARE SECTION;</code> 之间定义。</li>
<li>在SQL语句中，宿主变量前加 <code>:</code> 以区分SQL自身变量或属性名。</li>
<li>在宿主语言中，宿主变量作为普通变量使用。</li>
<li><strong>不能</strong>定义为数组或结构体。</li>
</ul>
</li>
<li><strong>SQLCA</strong>（SQL Communication Area）：特殊的宿主变量，用于获取SQL语句执行状态。<!-- -->
<ul>
<li><code>EXEC SQL INCLUDE SQLCA;</code></li>
<li><code>SQLCA.SQLCODE</code>：用于判断结果状态。</li>
</ul>
</li>
<li><strong>指示符变量</strong>（Indicator Variable）：<code>short int</code> 类型，用于处理宿主语言中的 <code>NULL</code> 值。</li>
</ul>
<p><strong>示例</strong>：宿主变量定义</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXEC SQL BEGIN DECLARE SECTION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token plain"> SNO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token plain"> GIVENSNO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token plain"> CNO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token plain"> GIVENCNO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">float</span><span class="token plain"> GRADE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">short</span><span class="token plain"> GRADEI</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/* indicator for GRADE */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXEC SQL END DECLARE SECTION</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="64-可执行语句-executable-statements">6.4 可执行语句 (Executable Statements)<a href="#64-可执行语句-executable-statements" class="hash-link" aria-label="Direct link to 6.4 可执行语句 (Executable Statements)" title="Direct link to 6.4 可执行语句 (Executable Statements)">​</a></h3>
<ul>
<li><strong>CONNECT</strong>：连接到数据库。<!-- -->
<ul>
<li><code>EXEC SQL CONNECT :uid IDENTIFIED BY :pwd;</code></li>
</ul>
</li>
<li><strong>执行DDL或DML语句</strong>：<!-- -->
<ul>
<li><code>EXEC SQL INSERT INTO SC(SNO, CNO, GRADE) VALUES(:SNO, :CNO, :GRADE);</code></li>
</ul>
</li>
<li><strong>执行查询语句</strong>（单行结果）：<!-- -->
<ul>
<li><code>EXEC SQL SELECT GRADE INTO :GRADE :GRADEI FROM SC WHERE SNO = :GIVENSNO AND CNO = :GIVENCNO;</code></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="65-游标-cursor">6.5 游标 (Cursor)<a href="#65-游标-cursor" class="hash-link" aria-label="Direct link to 6.5 游标 (Cursor)" title="Direct link to 6.5 游标 (Cursor)">​</a></h3>
<p>当查询结果包含多行时，需要使用<strong>游标</strong>（Cursor）来逐行处理结果集。</p>
<ol>
<li><strong>定义游标</strong>：
<code>EXEC SQL DECLARE &lt;cursor name&gt; CURSOR FOR SELECT ... FROM ... WHERE ...;</code></li>
<li><strong>打开游标</strong>：
<code>EXEC SQL OPEN &lt;cursor name&gt;;</code> (类似于打开文件)</li>
<li><strong>从游标中获取数据</strong>：
<code>EXEC SQL FETCH &lt;cursor name&gt; INTO :hostvar1, :hostvar2, ...;</code>
<ul>
<li>当到达游标末尾时，<code>SQLCA.SQLCODE</code> 将返回100。</li>
</ul>
</li>
<li><strong>关闭游标</strong>：
<code>EXEC SQL CLOSE &lt;cursor name&gt;;</code></li>
</ol>
<p><strong>示例</strong>：使用游标查询</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXEC SQL DECLARE C1 CURSOR FOR</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT SNO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> GRADE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM SC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WHERE CNO </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain">GIVENCNO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXEC SQL OPEN C1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">SQLCA</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">SQLCODE </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">exit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/* Error in query */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    EXEC SQL FETCH C1 INTO </span><span class="token operator">:</span><span class="token plain">SNO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain">GRADE </span><span class="token operator">:</span><span class="token plain">GRADEI</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">SQLCA</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">SQLCODE </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">break</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">/* Process fetched data */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXEC SQL CLOSE C1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="66-动态sql-dynamic-sql">6.6 动态SQL (Dynamic SQL)<a href="#66-动态sql-dynamic-sql" class="hash-link" aria-label="Direct link to 6.6 动态SQL (Dynamic SQL)" title="Direct link to 6.6 动态SQL (Dynamic SQL)">​</a></h3>
<p><strong>概念</strong>：在程序运行时动态构建和执行SQL语句。适用于SQL语句在编译前无法确定的情况。</p>
<ul>
<li><strong>直接执行动态SQL</strong>：<!-- -->
<ul>
<li>仅用于非查询SQL语句。</li>
<li><code>EXEC SQL EXECUTE IMMEDIATE :sqlstring;</code></li>
<li><strong>示例</strong>：<!-- -->
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token plain"> sqlstring</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">200</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token plain"> cond</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">150</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">strcpy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">sqlstring</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;DELETE FROM STUDENT WHERE &quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">printf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot; Enter search condition :&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">scanf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;%s&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> cond</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">strcat</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">sqlstring</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> cond</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXEC SQL EXECUTE IMMEDIATE </span><span class="token operator">:</span><span class="token plain">sqlstring</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
</li>
</ul>
</li>
<li><strong>带动态参数的动态SQL</strong>：<!-- -->
<ul>
<li>
<p>仅用于非查询SQL语句 。</p>
</li>
<li>
<p>使用<strong>占位符</strong>（place holder）实现动态参数。</p>
</li>
<li>
<p><code>EXEC SQL PREPARE &lt;statement_name&gt; FROM :sqlstring;</code></p>
</li>
<li>
<p><code>EXEC SQL EXECUTE &lt;statement_name&gt; USING :param1, :param2, ...;</code></p>
</li>
<li>
<p><strong>示例</strong>：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token plain"> sqlstring</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">200</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> birth_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">strcpy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">sqlstring</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;DELETE FROM STUDENT WHERE YEAR(BDATE) &lt;= :y;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">printf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot; Enter birth year for delete :&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">scanf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;%d&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">birth_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXEC SQL PREPARE purge FROM </span><span class="token operator">:</span><span class="token plain">sqlstring</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXEC SQL EXECUTE purge USING </span><span class="token operator">:</span><span class="token plain">birth_year</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
</li>
</ul>
</li>
<li><strong>用于查询的动态SQL</strong>：<!-- -->
<ul>
<li>用于动态构建查询语句。</li>
<li>结合 <code>PREPARE</code> 和游标使用。</li>
<li><strong>示例</strong>：<!-- -->
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token plain"> sqlstring</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">200</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token plain"> SNO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">float</span><span class="token plain"> GRADE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">short</span><span class="token plain"> GRADEI</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token plain"> GIVENCNO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token plain"> orderby</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">150</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">strcpy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">sqlstring</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;SELECT SNO, GRADE FROM SC WHERE CNO = :c&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">printf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot; Enter the ORDER BY clause :&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">scanf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;%s&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> orderby</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">strcat</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">sqlstring</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> orderby</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">printf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot; Enter the course number :&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">scanf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;%s&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> GIVENCNO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXEC SQL PREPARE query FROM </span><span class="token operator">:</span><span class="token plain">sqlstring</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXEC SQL DECLARE grade_cursor CURSOR FOR query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXEC SQL OPEN grade_cursor USING </span><span class="token operator">:</span><span class="token plain">GIVENCNO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    EXEC SQL FETCH grade_cursor INTO </span><span class="token operator">:</span><span class="token plain">SNO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain">GRADE </span><span class="token operator">:</span><span class="token plain">GRADEI</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">SQLCA</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">SQLCODE </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">break</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">/* Process fetched data */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXEC SQL CLOSE grade_cursor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-存储过程-stored-procedure">7. 存储过程 (Stored Procedure)<a href="#7-存储过程-stored-procedure" class="hash-link" aria-label="Direct link to 7. 存储过程 (Stored Procedure)" title="Direct link to 7. 存储过程 (Stored Procedure)">​</a></h2>
<p><strong>概念</strong>：将常用的数据库访问程序作为过程存储在数据库中，编译后可直接调用。</p>
<ul>
<li><strong>优点</strong>：<!-- -->
<ul>
<li><strong>方便用户</strong>（Make User Convenient）：用户可以直接调用，无需重复编写代码，可重用。</li>
<li><strong>提高性能</strong>（Improve Performance）：存储过程已编译，无需再次解析和查询优化，执行效率高。</li>
<li><strong>扩展DBMS功能</strong>（Expand Function of DBMS）：可以通过编写脚本扩展DBMS的功能。</li>
</ul>
</li>
</ul>
<p><strong>示例</strong>：删除学生的存储过程</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">EXEC</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PROCEDURE</span><span class="token plain"> drop_student</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">IN</span><span class="token plain"> student_no </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">OUT</span><span class="token plain"> message </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">30</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BEGIN</span><span class="token plain"> ATOMIC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DELETE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> STUDENT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> SNO </span><span class="token operator">=</span><span class="token plain"> student_no</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DELETE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> SC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> SNO </span><span class="token operator">=</span><span class="token plain"> student_no</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SET</span><span class="token plain"> message </span><span class="token operator">=</span><span class="token plain"> student_no </span><span class="token operator">||</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27; droped&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">END</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p><strong>调用示例</strong>：
<code>EXEC SQL CALL drop_student(...);</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-事务管理-transaction-management">8. 事务管理 (Transaction Management)<a href="#8-事务管理-transaction-management" class="hash-link" aria-label="Direct link to 8. 事务管理 (Transaction Management)" title="Direct link to 8. 事务管理 (Transaction Management)">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="81-事务-transaction">8.1 事务 (Transaction)<a href="#81-事务-transaction" class="hash-link" aria-label="Direct link to 8.1 事务 (Transaction)" title="Direct link to 8.1 事务 (Transaction)">​</a></h3>
<ul>
<li><strong>概念</strong>：事务是数据库管理系统执行过程中的一个逻辑工作单元，它由一个或多个数据库操作组成。这些操作要么全部成功，要么全部失败。</li>
<li><strong>ACID特性</strong>：事务必须满足以下四个基本特性，以确保数据的一致性和可靠性。<!-- -->
<ul>
<li><strong>原子性</strong>（Atomicity）：事务是一个不可分割的工作单位，事务中的操作要么全部成功提交，要么全部失败回滚。</li>
<li><strong>一致性</strong>（Consistency）：事务执行前后，数据库从一个一致状态转换到另一个一致状态。这意味着事务的执行不能破坏数据库的完整性约束。</li>
<li><strong>隔离性</strong>（Isolation）：并发执行的事务之间互不干扰，一个事务的执行不应影响其他事务的执行，就好像它们是串行执行的一样。</li>
<li><strong>持久性</strong>（Durability）：一旦事务成功提交，它对数据库的改变就是永久的，即使系统发生故障，这些改变也不会丢失。</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="82-事务状态-transaction-states">8.2 事务状态 (Transaction States)<a href="#82-事务状态-transaction-states" class="hash-link" aria-label="Direct link to 8.2 事务状态 (Transaction States)" title="Direct link to 8.2 事务状态 (Transaction States)">​</a></h3>
<p>事务在执行过程中会经历不同的状态：</p>
<ul>
<li><strong>活动状态</strong>（Active）：事务的初始状态，事务正在执行中。</li>
<li><strong>部分提交状态</strong>（Partially Committed）：事务的最后一个操作已经执行，但数据尚未完全写入磁盘。</li>
<li><strong>失败状态</strong>（Failed）：事务的正常执行被中断，可能是由于系统错误、死锁或违反完整性约束等。</li>
<li><strong>中止状态</strong>（Aborted）：事务在失败状态后，数据库系统撤销（undo）了事务对数据库的所有修改，使数据库恢复到事务开始前的状态。</li>
<li><strong>提交状态</strong>（Committed）：事务成功完成，所有修改已永久保存到数据库中。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="83-事务操作-transaction-operations">8.3 事务操作 (Transaction Operations)<a href="#83-事务操作-transaction-operations" class="hash-link" aria-label="Direct link to 8.3 事务操作 (Transaction Operations)" title="Direct link to 8.3 事务操作 (Transaction Operations)">​</a></h3>
<ul>
<li><strong>BEGIN TRANSACTION</strong> 或 <strong>START TRANSACTION</strong>：标记事务的开始。</li>
<li><strong>COMMIT</strong>：提交事务，使所有修改永久生效。</li>
<li><strong>ROLLBACK</strong>：回滚事务，撤销所有修改，使数据库恢复到事务开始前的状态。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="84-并发控制-concurrency-control">8.4 并发控制 (Concurrency Control)<a href="#84-并发控制-concurrency-control" class="hash-link" aria-label="Direct link to 8.4 并发控制 (Concurrency Control)" title="Direct link to 8.4 并发控制 (Concurrency Control)">​</a></h3>
<ul>
<li><strong>概念</strong>：并发控制是管理并发事务以确保数据库一致性和隔离性的技术。</li>
<li><strong>并发问题</strong>：<!-- -->
<ul>
<li><strong>丢失更新</strong>（Lost Update）：一个事务的更新被另一个事务的更新 覆盖。</li>
<li><strong>脏读</strong>（Dirty Read）：一个事务读取了另一个未提交事务的数据，如果后者回滚，则前者读取的数据是无效的。</li>
<li><strong>不可重复读</strong>（Non-repeatable Read）：一个事务两次读取同一数据，但在这两次读取之间，另一个事务修改了该数据并提交，导致两次读取结果不同。</li>
<li><strong>幻读</strong>（Phantom Read）：一个事务在两次查询之间，另一个事务插入了满足查询条件的新行并提交，导致第一次查询未发现的行在第二次查询中出现。</li>
</ul>
</li>
<li><strong>并发控制技术</strong>：<!-- -->
<ul>
<li><strong>锁</strong>（Locking）：最常用的并发控制机制。<!-- -->
<ul>
<li><strong>共享锁</strong>（Shared Lock, S-lock）：允许多个事务同时读取同一数据。</li>
<li><strong>排他锁</strong>（Exclusive Lock, X-lock）：只允许一个事务对数据进行读写操作，其他事务不能同时访问。</li>
<li><strong>两阶段封锁协议</strong>（Two-Phase Locking, 2PL）：<!-- -->
<ul>
<li><strong>增长阶段</strong>（Growing Phase）：事务只能获得锁，不能释放锁。</li>
<li><strong>收缩阶段</strong>（Shrinking Phase）：事务只能释放锁，不能获得锁。</li>
<li>2PL可以保证<strong>可串行性</strong>（Serializability），即并发执行的结果与某个串行执行的结果相同。</li>
</ul>
</li>
</ul>
</li>
<li><strong>时间戳排序</strong>（Timestamp Ordering）：为每个事务分配一个唯一的时间戳，根据时间戳来决定事务的执行顺序。</li>
<li><strong>多版本并发控制</strong>（Multi-Version Concurrency Control, MVCC）：为数据项维护多个版本，读操作可以读取旧版本数据，写操作创建新版本，从而减少读写冲突。</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="85-事务隔离级别-transaction-isolation-levels">8.5 事务隔离级别 (Transaction Isolation Levels)<a href="#85-事务隔离级别-transaction-isolation-levels" class="hash-link" aria-label="Direct link to 8.5 事务隔离级别 (Transaction Isolation Levels)" title="Direct link to 8.5 事务隔离级别 (Transaction Isolation Levels)">​</a></h3>
<p>SQL标准定义了四种事务隔离级别，从低到高依次提供不同程度的隔离性，以平衡并发性和数据一致性：</p>
<ul>
<li><strong>读未提交</strong>（Read Uncommitted）：<!-- -->
<ul>
<li>最低隔离级别。</li>
<li>允许一个事务读取另一个未提交事务的数据（可能导致<strong>脏读</strong>）。</li>
</ul>
</li>
<li><strong>读已提交</strong>（Read Committed）：<!-- -->
<ul>
<li>一个事务只能读取已经提交的数据。</li>
<li>可以避免<strong>脏读</strong>，但可能出现<strong>不可重复读</strong>和<strong>幻读</strong>。</li>
</ul>
</li>
<li><strong>可重复读</strong>（Repeatable Read）：<!-- -->
<ul>
<li>一个事务在整个执行过程中，对同一数据的多次读取结果保持一致。</li>
<li>可以避免<strong>脏读</strong>和<strong>不可重复读</strong>，但可能出现<strong>幻读</strong>。</li>
</ul>
</li>
<li><strong>串行化</strong>（Serializable）：<!-- -->
<ul>
<li>最高隔离级别。</li>
<li>事务之间完全隔离，就好像它们是串行执行的一样。</li>
<li>可以避免所有并发问题（<strong>脏读</strong>、<strong>不可重复读</strong>、<strong>幻读</strong>）。</li>
<li>并发性最低，性能开销最大。</li>
</ul>
</li>
</ul>
<p><strong>隔离级别与并发问题对照表</strong>：</p>
<table><thead><tr><th style="text-align:left">隔离级别</th><th style="text-align:left">脏读 (Dirty Read)</th><th style="text-align:left">不可重复读 (Non-repeatable Read)</th><th style="text-align:left">幻读 (Phantom Read)</th></tr></thead><tbody><tr><td style="text-align:left">读未提交 (Read Uncommitted)</td><td style="text-align:left">可能</td><td style="text-align:left">可能</td><td style="text-align:left">可能</td></tr><tr><td style="text-align:left">读已提交 (Read Committed)</td><td style="text-align:left">否</td><td style="text-align:left">可能</td><td style="text-align:left">可能</td></tr><tr><td style="text-align:left">可重复读 (Repeatable Read)</td><td style="text-align:left">否</td><td style="text-align:left">否</td><td style="text-align:left">可能</td></tr><tr><td style="text-align:left">串行化 (Serializable)</td><td style="text-align:left">否</td><td style="text-align:left">否</td><td style="text-align:left">否</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="9-数据库恢复-database-recovery">9. 数据库恢复 (Database Recovery)<a href="#9-数据库恢复-database-recovery" class="hash-link" aria-label="Direct link to 9. 数据库恢复 (Database Recovery)" title="Direct link to 9. 数据库恢复 (Database Recovery)">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="91-故障分类-failure-classification">9.1 故障分类 (Failure Classification)<a href="#91-故障分类-failure-classification" class="hash-link" aria-label="Direct link to 9.1 故障分类 (Failure Classification)" title="Direct link to 9.1 故障分类 (Failure Classification)">​</a></h3>
<p>数据库系统可能面临多种类型的故障：</p>
<ul>
<li><strong>事务故障</strong>（Transaction Failure）：<!-- -->
<ul>
<li><strong>逻辑错误</strong>：事务内部的错误，如除以零、数据溢出。</li>
<li><strong>系统错误</strong>：死锁、资源不足等导致事务无法继续执行。</li>
</ul>
</li>
<li><strong>系统崩溃</strong>（System Crash）：<!-- -->
<ul>
<li>硬件故障（如CPU、内存故障）、操作系统错误、DBMS软件错误等导致系统突然停止运行，内存中的数据丢失。</li>
</ul>
</li>
<li><strong>磁盘故障</strong>（Disk Failure）：<!-- -->
<ul>
<li>存储设备损坏，导致存储在磁盘上的数据丢失。</li>
</ul>
</li>
<li><strong>灾难</strong>（Catastrophe）：<!-- -->
<ul>
<li>火灾、地震、洪水等自然灾害，导致整个数据库系统物理损坏。</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="92-恢复技术-recovery-techniques">9.2 恢复技术 (Recovery Techniques)<a href="#92-恢复技术-recovery-techniques" class="hash-link" aria-label="Direct link to 9.2 恢复技术 (Recovery Techniques)" title="Direct link to 9.2 恢复技术 (Recovery Techniques)">​</a></h3>
<p>数据库恢复的目标是在发生故障后，将数据库恢复到故障发生前的一致状态。</p>
<ul>
<li><strong>日志</strong>（Log / Journal）：<!-- -->
<ul>
<li><strong>概念</strong>：记录数据库所有更新操作的顺序文件。日志是数据库恢复的核心。</li>
<li><strong>内容</strong>：通常包括事务ID、操作类型（插入、删除、更新）、操作对象（表名、记录ID）、旧值、新值等。</li>
<li><strong>作用</strong>：<!-- -->
<ul>
<li><strong>撤销</strong>（Undo）：通过日志中的旧值来撤销未提交事务的修改。</li>
<li><strong>重做</strong>（Redo）：通过日志中的新值来重做已提交事务的修改。</li>
</ul>
</li>
</ul>
</li>
<li><strong>检查点</strong>（Checkpoint）：<!-- -->
<ul>
<li><strong>概念</strong>：数据库系统周期性地执行的一个操作，将内存中所有已修改的数据块强制写入磁盘，并记录当前所有活动事务的列表。</li>
<li><strong>作用</strong>：缩短恢复时间，因为恢复过程只需从最近的检查点开始，而不是从日志的开头。</li>
</ul>
</li>
<li><strong>数据库转储/备份</strong>（Database Dump / Backup）：<!-- -->
<ul>
<li><strong>概念</strong>：定期将整个数据库或部分数据库复制到独立的存储介质上。</li>
<li><strong>作用</strong>：用于应对磁盘故障或灾难性故障，通过备份和日志文件结合进行恢复。</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="93-恢复算法-recovery-algorithms">9.3 恢复算法 (Recovery Algorithms)<a href="#93-恢复算法-recovery-algorithms" class="hash-link" aria-label="Direct link to 9.3 恢复算法 (Recovery Algorithms)" title="Direct link to 9.3 恢复算法 (Recovery Algorithms)">​</a></h3>
<ul>
<li><strong>基于日志的恢复</strong>：<!-- -->
<ul>
<li><strong>延迟更新</strong>（Deferred Update）：事务的修改在提交时才写入磁盘。<!-- -->
<ul>
<li>恢复时只需重做已提交事务的修改。</li>
</ul>
</li>
<li><strong>立即更新</strong>（Immediate Update）：事务的修改在执行时就写入磁盘。<!-- -->
<ul>
<li>恢复时需要撤销未提交事务的修改，并重做已提交事务的修改。</li>
</ul>
</li>
</ul>
</li>
<li><strong>Aries恢复算法</strong>：<!-- -->
<ul>
<li>一种广泛使用的、基于日志的恢复算法，支持并发控制和多种故障类型。</li>
<li>主要思想：<!-- -->
<ul>
<li><strong>Write-Ahead Logging (WAL)</strong>：任何数据修改必须先写入日志，再写入磁盘。</li>
<li><strong>Repeating History</strong>：在恢复过程中，首先重做所有已提交和未提交事务的修改，以恢复到故障发生时的状态。</li>
<li><strong>Undo/Redo Logging</strong>：使用日志记录的旧值和新值进行撤销和重做操作。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="10-数据库安全性-database-security">10. 数据库安全性 (Database Security)<a href="#10-数据库安全性-database-security" class="hash-link" aria-label="Direct link to 10. 数据库安全性 (Database Security)" title="Direct link to 10. 数据库安全性 (Database Security)">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="101-安全性威胁-security-threats">10.1 安全性威胁 (Security Threats)<a href="#101-安全性威胁-security-threats" class="hash-link" aria-label="Direct link to 10.1 安全性威胁 (Security Threats)" title="Direct link to 10.1 安全性威胁 (Security Threats)">​</a></h3>
<ul>
<li><strong>未经授权的访问</strong>（Unauthorized Access）：非授权用户尝试访问数据库。</li>
<li><strong>数据泄露</strong>（Data Leakage）：敏感数据被未经授权地披露。</li>
<li><strong>数据篡改</strong>（Data Tampering）：数据被未经授权地修改、删除或破坏。</li>
<li><strong>拒绝服务攻击</strong>（Denial of Service, DoS）：攻击者通过消耗系统资源，阻止合法用户访问数据库。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="102-安全性机制-security-mechanisms">10.2 安全性机制 (Security Mechanisms)<a href="#102-安全性机制-security-mechanisms" class="hash-link" aria-label="Direct link to 10.2 安全性机制 (Security Mechanisms)" title="Direct link to 10.2 安全性机制 (Security Mechanisms)">​</a></h3>
<ul>
<li><strong>用户认证</strong>（User Authentication）：<!-- -->
<ul>
<li><strong>概念</strong>：验证用户身份的过程，确保只有合法用户才能访问系统。</li>
<li><strong>方法</strong>：用户名/密码、生物识别、多因素认证等。</li>
</ul>
</li>
<li><strong>访问控制</strong>（Access Control）：<!-- -->
<ul>
<li><strong>概念</strong>：根据用户的身份和权限，限制其对数据库对象的访问。</li>
<li><strong>自主访问控制</strong>（Discretionary Access Control, DAC）：<!-- -->
<ul>
<li><strong>概念</strong>：数据库对象的所有者可以自主决定将访问权限授予其他用户。</li>
<li><strong>GRANT/REVOKE语句</strong>：SQL中的 <code>GRANT</code> 用于授予权限，<code>REVOKE</code> 用于撤销权限。</li>
<li><strong>权限类型</strong>：<code>SELECT</code>（查询）、<code>INSERT</code>（插入）、<code>UPDATE</code>（更新）、<code>DELETE</code>（删除）、<code>REFERENCES</code>（引用）、<code>ALL PRIVILEGES</code>（所有权限）等。</li>
<li><strong>WITH GRANT OPTION</strong>：允许被授权用户将其获得的权限再授予其他用户。</li>
</ul>
</li>
<li><strong>强制访问控制</strong>（Mandatory Access Control, MAC）：<!-- -->
<ul>
<li><strong>概念</strong>：基于安全级别和分类标签，由系统强制执行的访问控制策略。</li>
<li><strong>用途</strong>：适用于高度安全的系统，如军事、政府等。</li>
</ul>
</li>
<li><strong>基于角色的访问控制</strong>（Role-Based Access Control, RBAC）：<!-- -->
<ul>
<li><strong>概念</strong>：将权限分配给角色，再将角色分配给用户。</li>
<li><strong>优点</strong>：简化权限管理，提高安全性。</li>
</ul>
</li>
</ul>
</li>
<li><strong>视图</strong>（Views）：<!-- -->
<ul>
<li><strong>概念</strong>：通过创建视图，可以限制用户只能看到表中的部分数据或列，从而实现数据隐藏。</li>
</ul>
</li>
<li><strong>加密</strong>（Encryption）：<!-- -->
<ul>
<li><strong>概念</strong>：将数据转换为密文，防止未经授权的访问者理解数据内容。</li>
<li><strong>类型</strong>：数据传输加密、数据存储加密。</li>
</ul>
</li>
<li><strong>审计</strong>（Auditing）：<!-- -->
<ul>
<li><strong>概念</strong>：记录所有数据库操作，以便追踪和分析可疑活动。</li>
<li><strong>用途</strong>：发现安全漏洞、追溯攻击来源、满足合规性要求。</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="11-数据库完整性-database-integrity">11. 数据库完整性 (Database Integrity)<a href="#11-数据库完整性-database-integrity" class="hash-link" aria-label="Direct link to 11. 数据库完整性 (Database Integrity)" title="Direct link to 11. 数据库完整性 (Database Integrity)">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="111-完整性约束-integrity-constraints">11.1 完整性约束 (Integrity Constraints)<a href="#111-完整性约束-integrity-constraints" class="hash-link" aria-label="Direct link to 11.1 完整性约束 (Integrity Constraints)" title="Direct link to 11.1 完整性约束 (Integrity Constraints)">​</a></h3>
<ul>
<li><strong>概念</strong>：数据库完整性是指数据库中数据的正确性、有效性和一致性。完整性约束是确保这些特性的规则。</li>
<li><strong>类型</strong>：<!-- -->
<ul>
<li><strong>域完整性</strong>（Domain Integrity）：<!-- -->
<ul>
<li><strong>概念</strong>：限制列中允许的值的范围或类型。</li>
<li><strong>实现</strong>：通过数据类型、<code>CHECK</code> 约束、<code>DEFAULT</code> 值、<code>NOT NULL</code> 约束等。</li>
</ul>
</li>
<li><strong>实体完整性</strong>（Entity Integrity）：<!-- -->
<ul>
<li><strong>概念</strong>：确保表中的每一行都有唯一的标识。</li>
<li><strong>实现</strong>：通过<strong>主键</strong>（PRIMARY KEY）约束，主键列的值必须唯一且不能为NULL。</li>
</ul>
</li>
<li><strong>参照完整性</strong>（Referential Integrity）：<!-- -->
<ul>
<li><strong>概念</strong>：确保表之间引用关系的有效性，防止引用不存在的数据。</li>
<li><strong>实现</strong>：通过<strong>外键</strong>（FOREIGN KEY）约束。外键值必须引用被引用表中的现有主键值，或者为NULL。</li>
<li><strong>外键操作</strong>：<!-- -->
<ul>
<li><strong>ON DELETE CASCADE</strong>：当被引用行被删除时，引用该行的所有行也随之删除。</li>
<li><strong>ON DELETE SET NULL</strong>：当被引用行被删除时，引用该行的外键值设为NULL。</li>
<li><strong>ON DELETE RESTRICT</strong>：如果存在引用该行的外键，则不允许删除被引用行。</li>
<li><strong>ON DELETE NO ACTION</strong>：与RESTRICT类似，但检查时机可能不同。</li>
</ul>
</li>
</ul>
</li>
<li><strong>用户定义完整性</strong>（User-Defined Integrity）：<!-- -->
<ul>
<li><strong>概念</strong>：根据特定业务规则定义的完整性约束。</li>
<li><strong>实现</strong>：通过 <code>CHECK</code> 约束、触发器（Trigger）、存储过程（Stored Procedure）等。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="112-触发器-trigger">11.2 触发器 (Trigger)<a href="#112-触发器-trigger" class="hash-link" aria-label="Direct link to 11.2 触发器 (Trigger)" title="Direct link to 11.2 触发器 (Trigger)">​</a></h3>
<ul>
<li><strong>概念</strong>：一种特殊的存储过程，它在数据库中定义，并在特定事件（如 <code>INSERT</code>、<code>UPDATE</code>、<code>DELETE</code>）发生时自动执行。</li>
<li><strong>用途</strong>：<!-- -->
<ul>
<li>维护复杂的用户定义完整性约束。</li>
<li>实现业务规则。</li>
<li>自动生成审计日志。</li>
<li>级联更新或删除。</li>
</ul>
</li>
<li><strong>触发时机</strong>：<!-- -->
<ul>
<li><strong>BEFORE</strong>：在事件发生之前执行。</li>
<li><strong>AFTER</strong>：在事件发生之后执行。</li>
</ul>
</li>
<li><strong>触发粒度</strong>：<!-- -->
<ul>
<li><strong>FOR EACH ROW</strong>：对受事件影响的每一行执行一次。</li>
<li><strong>FOR EACH STATEMENT</strong>：对整个事件（语句）只执行一次。</li>
</ul>
</li>
</ul>
<p><strong>示例</strong>：
创建一个触发器，在学生表插入新行时，自动更新系表中的学生人数。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TRIGGER</span><span class="token plain"> update_dept_student_count</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AFTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> Students</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FOR EACH ROW</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UPDATE</span><span class="token plain"> Departments</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SET</span><span class="token plain"> student_count </span><span class="token operator">=</span><span class="token plain"> student_count </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> dept_id </span><span class="token operator">=</span><span class="token plain"> NEW</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dept_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">END</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本笔记涵盖了数据库原理中的核心概念，从数据模型、SQL语言的基础与高级特性，到事务管理、数据库恢复、安全性与完整性。</p>
<ul>
<li><strong>数据模型</strong>是理解数据库如何组织和表示数据的基石。</li>
<li><strong>SQL语言</strong>是与关系数据库交互的标准工具，掌握其查询、DML、DDL和DCL功能至关重要。特别是<strong>嵌套查询</strong>、<strong>聚合函数</strong>、<strong>GROUP BY/HAVING</strong>以及<strong>CTE</strong>等高级特性，是解决复杂查询的关键。</li>
<li><strong>事务管理</strong>的<strong>ACID特性</strong>是数据库可靠性的保障，<strong>并发控制</strong>和<strong>隔离级别</strong>是处理多用户并发访问的核心。</li>
<li><strong>数据库恢复</strong>和<strong>安全性</strong>是确保数据可用性和防止未经授权访问的重要机制。</li>
<li><strong>数据库完整性</strong>通过各种约束确保数据的正确性和一致性。</li>
</ul>
<p><strong>考试复习重点</strong>：</p>
<ul>
<li><strong>ACID特性</strong>：务必理解并能解释每个特性的含义。</li>
<li><strong>并发控制问题</strong>（脏读、不可重复读、幻读）及其与<strong>隔离级别</strong>的对应关系，<strong>对比记忆</strong>。</li>
<li><strong>SQL查询语句</strong>的各个子句（<code>SELECT</code>, <code>FROM</code>, <code>WHERE</code>, <code>GROUP BY</code>, <code>HAVING</code>）的执行顺序和作用。</li>
<li><strong>子查询</strong>的各种  形式（标量、表表达式、CTE）及其应用场景。</li>
<li><strong>聚合函数</strong>的使用，以及 <code>DISTINCT</code> 关键字对其行为的影响。</li>
<li><strong>外键</strong>的定义和<strong>参照完整性</strong>的维护（<code>ON DELETE</code> 选项）。</li>
<li><strong>NULL值</strong>在SQL中的特殊处理和三值逻辑。</li>
<li><strong>嵌入式SQL</strong>和<strong>动态SQL</strong>的概念及应用场景。</li>
<li><strong>存储过程</strong>和<strong>触发器</strong>的作用和优势。</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/note">note</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/db">db</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/LifeCheckpoint/LifeCheckpoint.github.io/tree/main/docs/notes/database-intro/ai_notes/Chapter 3. SQL.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/notes/database-intro/ai_notes/Chapter 2. 数据模型"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">02. 数据模型</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/notes/database-intro/ai_notes/Chapter 4. 系统原理"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">04. 系统原理</div></a></nav></div><div style="margin-top:20px"></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-其他数据模型-other-data-models" class="table-of-contents__link toc-highlight">1. 其他数据模型 (Other Data Models)</a><ul><li><a href="#11-逻辑数据模型-logic-based-data-model" class="table-of-contents__link toc-highlight">1.1 逻辑数据模型 (Logic-based Data Model)</a></li><li><a href="#12-时态数据模型-temporal-data-model" class="table-of-contents__link toc-highlight">1.2 时态数据模型 (Temporal Data Model)</a></li><li><a href="#13-空间数据模型-spatial-data-model" class="table-of-contents__link toc-highlight">1.3 空间数据模型 (Spatial Data Model)</a></li><li><a href="#14-xml数据模型-xml-data-model" class="table-of-contents__link toc-highlight">1.4 XML数据模型 (XML Data Model)</a></li></ul></li><li><a href="#2-数据库管理系统用户接口-user-interfaces-of-dbms" class="table-of-contents__link toc-highlight">2. 数据库管理系统用户接口 (User Interfaces of DBMS)</a></li><li><a href="#3-关系查询语言-relational-query-languages" class="table-of-contents__link toc-highlight">3. 关系查询语言 (Relational Query Languages)</a><ul><li><a href="#31-形式化关系查询语言-formal-relational-query-languages" class="table-of-contents__link toc-highlight">3.1 形式化关系查询语言 (Formal Relational Query Languages)</a></li><li><a href="#32-sql语言-sql-language" class="table-of-contents__link toc-highlight">3.2 SQL语言 (SQL Language)</a></li></ul></li><li><a href="#4-sql基本概念与查询-basic-sql-concepts-and-queries" class="table-of-contents__link toc-highlight">4. SQL基本概念与查询 (Basic SQL Concepts and Queries)</a><ul><li><a href="#41-重要术语和概念-important-terms-and-concepts" class="table-of-contents__link toc-highlight">4.1 重要术语和概念 (Important Terms and Concepts)</a></li><li><a href="#42-基本查询语句-basic-query-statement" class="table-of-contents__link toc-highlight">4.2 基本查询语句 (Basic Query Statement)</a></li></ul></li><li><a href="#5-sql新特性-new-features-of-sql" class="table-of-contents__link toc-highlight">5. SQL新特性 (New Features of SQL)</a><ul><li><a href="#51-cast表达式-cast-expression" class="table-of-contents__link toc-highlight">5.1 CAST表达式 (CAST Expression)</a></li><li><a href="#52-case表达式-case-expression" class="table-of-contents__link toc-highlight">5.2 CASE表达式 (CASE Expression)</a></li><li><a href="#53-子查询增强-sub-query-enhancements" class="table-of-contents__link toc-highlight">5.3 子查询增强 (Sub-query Enhancements)</a></li><li><a href="#54-外连接-outer-join" class="table-of-contents__link toc-highlight">5.4 外连接 (Outer Join)</a></li><li><a href="#55-递归查询-recursion" class="table-of-contents__link toc-highlight">5.5 递归查询 (Recursion)</a></li></ul></li><li><a href="#6-嵌入式sql-embedded-sql" class="table-of-contents__link toc-highlight">6. 嵌入式SQL (Embedded SQL)</a><ul><li><a href="#61-解决的问题-problems-to-be-solved" class="table-of-contents__link toc-highlight">6.1 解决的问题 (Problems to be Solved)</a></li><li><a href="#62-通用解决方案-general-solutions" class="table-of-contents__link toc-highlight">6.2 通用解决方案 (General Solutions)</a></li><li><a href="#63-嵌入式sql的使用-usage-of-embedded-sql" class="table-of-contents__link toc-highlight">6.3 嵌入式SQL的使用 (Usage of Embedded SQL)</a></li><li><a href="#64-可执行语句-executable-statements" class="table-of-contents__link toc-highlight">6.4 可执行语句 (Executable Statements)</a></li><li><a href="#65-游标-cursor" class="table-of-contents__link toc-highlight">6.5 游标 (Cursor)</a></li><li><a href="#66-动态sql-dynamic-sql" class="table-of-contents__link toc-highlight">6.6 动态SQL (Dynamic SQL)</a></li></ul></li><li><a href="#7-存储过程-stored-procedure" class="table-of-contents__link toc-highlight">7. 存储过程 (Stored Procedure)</a></li><li><a href="#8-事务管理-transaction-management" class="table-of-contents__link toc-highlight">8. 事务管理 (Transaction Management)</a><ul><li><a href="#81-事务-transaction" class="table-of-contents__link toc-highlight">8.1 事务 (Transaction)</a></li><li><a href="#82-事务状态-transaction-states" class="table-of-contents__link toc-highlight">8.2 事务状态 (Transaction States)</a></li><li><a href="#83-事务操作-transaction-operations" class="table-of-contents__link toc-highlight">8.3 事务操作 (Transaction Operations)</a></li><li><a href="#84-并发控制-concurrency-control" class="table-of-contents__link toc-highlight">8.4 并发控制 (Concurrency Control)</a></li><li><a href="#85-事务隔离级别-transaction-isolation-levels" class="table-of-contents__link toc-highlight">8.5 事务隔离级别 (Transaction Isolation Levels)</a></li></ul></li><li><a href="#9-数据库恢复-database-recovery" class="table-of-contents__link toc-highlight">9. 数据库恢复 (Database Recovery)</a><ul><li><a href="#91-故障分类-failure-classification" class="table-of-contents__link toc-highlight">9.1 故障分类 (Failure Classification)</a></li><li><a href="#92-恢复技术-recovery-techniques" class="table-of-contents__link toc-highlight">9.2 恢复技术 (Recovery Techniques)</a></li><li><a href="#93-恢复算法-recovery-algorithms" class="table-of-contents__link toc-highlight">9.3 恢复算法 (Recovery Algorithms)</a></li></ul></li><li><a href="#10-数据库安全性-database-security" class="table-of-contents__link toc-highlight">10. 数据库安全性 (Database Security)</a><ul><li><a href="#101-安全性威胁-security-threats" class="table-of-contents__link toc-highlight">10.1 安全性威胁 (Security Threats)</a></li><li><a href="#102-安全性机制-security-mechanisms" class="table-of-contents__link toc-highlight">10.2 安全性机制 (Security Mechanisms)</a></li></ul></li><li><a href="#11-数据库完整性-database-integrity" class="table-of-contents__link toc-highlight">11. 数据库完整性 (Database Integrity)</a><ul><li><a href="#111-完整性约束-integrity-constraints" class="table-of-contents__link toc-highlight">11.1 完整性约束 (Integrity Constraints)</a></li><li><a href="#112-触发器-trigger" class="table-of-contents__link toc-highlight">11.2 触发器 (Trigger)</a></li></ul></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>